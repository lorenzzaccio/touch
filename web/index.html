<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <link rel="stylesheet" href="./css/myStyle.css" type="text/css" />
        <link rel="stylesheet" href="./css/fd-slider.css" type="text/css" />
        <link href="./css/mcColorPicker.css" rel="stylesheet" type="text/css" />
        <title>Stock Manager</title>
        <script type="text/javascript" src="jquery/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="jquery/jquery.svg.js"></script>
        <script type="text/javascript" src="jquery/jquery.svgdom.js"></script>
        <script type="text/javascript" src="lib/fontdetect.js"></script>
        <script type="text/javascript" src="lib/combobox.js"></script>
        <script type="text/javascript" src="lib/textbox.js"></script>
        <script type="text/javascript" src="lib/slider.js"></script>
        <script type="text/javascript" src="lib/label.js"></script>
        <script type="text/javascript" src="lib/button.js"></script>
        <script type="text/javascript" src="lib/colourPicker.js"></script>
        <script type="text/javascript" src="lib/mapApp.js"></script>
        <script type="text/javascript" src="lib/timer.js"></script>
        <script type="text/javascript" src="lib/guiCbk.js"></script>
        <script type="text/javascript" src="lib/util.js"></script>
        <script type="text/javascript" src="lib/menu.js"></script>
        <script type="text/javascript" src="lib/graphic.js"></script>
        <script type="text/javascript" src="lib/helper_functions.js"></script>
        <script type="text/javascript" src="lib/cookie.js"></script>
        <script type="text/javascript" src="lib/table.js"></script>
        <script type="text/javascript" src="lib/gui.js"></script>
        <script type="text/javascript" src="lib/forme.js"></script>
        <script type="text/javascript" src="lib/sql.js"></script>
        <script type="text/javascript" src="lib/fd-slider.js"></script>
        <script src="lib/mcColorPicker.js" type="text/javascript"></script> 
        
       

        <script type="text/javascript">
            //global vars
            var arrec = [];
            var g;
            var selectedItem;
            var menuSvg;
            var globalVar;
            var myGraph;
            //var objStock = new stock();

            $(function(){
                $('#svgbasics').svg({onLoad: drawInitial});
                drawcaps();
            });

            function drawInitial() {
                initEventHandler();
                $('#svgbasics').svg('get').clear();
                g = $('#svgbasics').svg('get').group({id: 'mainGroup'});
                myGraph = new graphic(g,globalVar);
                //initialize();
                stock.init();
                updateViewCookie();
                initSlider();
                activeView="ROOM";
            }
            
            function updateViewCookie(){
                var tabView = [];
                tabView[0] = zoomx;
                tabView[1] = zoomy;
                tabView[2] = zoomw;
                tabView[3] = zoomh;
                setCookie("viewbox",tabView,5);
            }
            function initSlider(){
                $('input[min]').each(function() {
                this.onchange = updateS;
                }); 
            }
            
            function updateS(){
                var val = parseFloat(this.value);
                var svg = $('#svgbasics').svg('get');
                zoomx = 100 * val;
                //zoomw = 842*val;//  + step/ratioZoom;
                //zoomh = val*842;//  + step/ratioZoom;
                ratioZoom = zoomw/842;
                var toto = document.getElementById("wheelvalue");
                toto.value=ratioZoom; 
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            var step = 80;
            var zoomx = 0 ;
            var zoomy = 0 ;
            var zoomh = 800;
            var zoomw = 842;
            function left(){
                var svg = $('#svgbasics').svg('get');
                zoomx = zoomx + step/ratioZoom;
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            function right(){
                var svg = $('#svgbasics').svg('get');
                zoomx = zoomx - step/ratioZoom;
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            function down(){
                var svg = $('#svgbasics').svg('get');
                zoomy = zoomy  - step/ratioZoom;
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            
            function up(){
                var svg = $('#svgbasics').svg('get');
                zoomy = zoomy  + step/ratioZoom;
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            
            function zoommoins(){
                var svg = $('#svgbasics').svg('get');
                
                zoomw = zoomw  + step/ratioZoom;
                zoomh = zoomh  + step/ratioZoom;
                ratioZoom = zoomw/842;
                var toto = document.getElementById("wheelvalue");
                toto.value=ratioZoom; 
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            
            function zoomplus(){
                var svg = $('#svgbasics').svg('get');
                zoomw = zoomw  - step/ratioZoom;
                zoomh = zoomh  - step/ratioZoom;
                ratioZoom = zoomw/842;
                svg.configure({viewBox: zoomx+' '+zoomy+' '+zoomw+' '+zoomh})
                updateViewCookie()
            }
            
            function drawcaps() {
                myGraph.updateViewBox();
                var displayList = []; 
                
                $('#svgbasics').svg('get').clear();
                g = $('#svgbasics').svg('get').group({id: 'mainGroup'});
                if(activeView == "CARTON")
                    myGraph.drawPalette30();
                
                var arrow = [];
                var rowLength = 0;  
                if(arrec==null)
                    return;
                rowLength = arrec.length;
                if(rowLength>0){
                    var k =0;
                    for(var j = 0 ; j< rowLength;j++){
                        arrow = arrec[j];
                        if(arrow[WARE_HEADER]!=null){
                            displayList[k] = j;
                            k++;
                        }
                    }
                    for(var j = 0 ; j<= 100;j++){
                        for(var l = 0 ; l< k;l++){//on demarre à 1 car 0 c'est le header'
                            arrow = arrec[displayList[l]];
                            if(arrow[ORDER_HEADER] == j){
                                if(activeView == "ROOM")
                                    filter="room";
                                if(activeView == "CARTON")
                                    filter=selectedPalette;
                                
                                if((arrow[FORME_HEADER] == "rectangle")&&(arrow[VIEW_HEADER]==filter)){
                                    var id = arrow[ID_HEADER];//posx
                                    var x = arrow[X_HEADER];//posx
                                    var y = arrow[Y_HEADER];//posy
                                    var height = arrow[HEIGHT_HEADER];//posy
                                    var width = arrow[WIDTH_HEADER];//posy
                                    var transx = arrow[TRANSX_HEADER];//transx
                                    var transy = arrow[TRANSY_HEADER];//transy
                                    var rotate = arrow[ROTATE_HEADER];
                                    var texte = arrow[TEXTE_HEADER];//texte
                                    var arg1 = arrow[ARG1_HEADER];
                                    var arg2 = arrow[ARG2_HEADER];
                                    var fillColor = arrow[FILLCOLOR_HEADER];//color
                                    var strokeColor = arrow[STROKECOLOR_HEADER];//stroke color
                                    var quantite = arrow[QUANTITE_HEADER];//quantity
                                    
                                    var group = drawRect(arrow);
                                    if(activeView=="ROOM"){
                                        drawText(group,id,strokeColor,texte,0,x-(-5),y-(-height),rotate);
                                        drawText(group,id,strokeColor,quantite.toString() ,1,x-(-5),y-(-height),rotate);
                                    }
                                    if (activeView=="CARTON"){
                                        drawText(group,id,strokeColor,arg1+"-"+arg2,0,x-(-5),y-(-height),rotate);
                                        drawText(group,id,strokeColor,quantite.toString() ,1,x-(-5),y-(-height),rotate);
                                    }
                                    
                                    }
                          }
                        }
                      }
                    
                    for(var j = 0 ; j< rowLength;j++){
                        //arrow= readRow(tableId,j);
                        arrow = arrec[j];
                    }
                }else{
                    //alert("tbl is null");
                }
                
            }
            
            function removeLclDb(){
                stock.storeRemoveAll();
                initArray();
                stock.init();
                drawcaps();
            }
            function initArray(){
                var i=0;
                arrec=null;
                arrec = [];
            }
            function updateBtn(){
                updatePhp("plan_transx",transx,"plan_index",selectedIndex);
            }
            function syncM2SBtn(){
                syncM2SPhp();
            }
            function syncS2MBtn(){
                stock.storeRemoveAll();
                syncS2MPhp();
                //initArray();
                //stock.init();
                drawInitial();
                setTimeout("drawcaps()", 800);
            }
            
            
            
            var stock = {
    index: window.localStorage.getItem("stock:index"),

    init: function() {
        // initialize the storage index
        if (!stock.index) {
            window.localStorage.setItem("stock:index", stock.index = 1);
        }

        // initialize the form
        

        // initialize the table and populate it with data stored in web storage
        if (window.localStorage.length - 1) {
            var stock_list = [], i, key;
            for (i = 0; i < window.localStorage.length; i++) {
                key = window.localStorage.key(i);
                if (/stock\d+/.test(key)) {
                    stock_list.push(JSON.parse(window.localStorage.getItem(key)));
                }
            }

            if (stock_list.length) {
                stock_list
                    .sort(function(a, b) {
                        return a.id < b.id ? -1 : (a.id > b.id ? 1 : 0);
                    })
                    .forEach(stock.tableAdd);
            }
        }
        
    },
    storeAdd: function(entry) {
        entry.index = stock.index;
        window.localStorage.setItem("stock"+ entry.index, JSON.stringify(entry));
        window.localStorage.setItem("stock:index", ++stock.index);
        //console.log("new entry ...");
    },
    storeRead:function(entry){
        
    },
    storeEdit: function(entry) {},
    storeUpdate: function(entry) {
        window.localStorage.setItem("stock"+ entry.index, JSON.stringify(entry));
    },
    storeRemoveAll: function(entry) {
        var  key,j,i;
        j=0;
        
        if (window.localStorage.length - 1) {
            //for(i=0;i<100;i++){
                
            while(window.localStorage.length>0){
            key = window.localStorage.key(i);
                if (/stock+/.test(key)) {
                    window.localStorage.removeItem(key);//(window.localStorage.getItem(key)));
                }
            } 
            if (stock.index) 
                window.localStorage.setItem("stock:index", stock.index = 1);
        }
            
    },

    tableAdd: function(entry) {
        var arrow  = [];
        var  key,j;
        j=0;
        for (key in entry) {
            if (entry.hasOwnProperty(key)) {
                arrow[j] = entry[key];
                j=j+1;
            }
        }
        arrec[entry.index-1] = arrow;
    },
    tableEdit: function(entry) {},
    tableRemove: function(entry) {}
    
};
function createForm() { //document.getElementById("left_column").innerHTML = '<input type="button" id="cinput2" class="color" value="#00aa00" />'; 
//<input type="text" id="cinput2" class="color" value="#00aa00" style="width:200px;height:50px"
 };
function OnColorChanged(selectedColor, colorPickerIndex) { 
    /*var divA = document.getElementById("divA"); 
    var divB = document.getElementById("divB"); 
    if (colorPickerIndex==0) 
        divA.style.color = selectedColor; 
    else 
        if (colorPickerIndex==1) 
            divB.style.color = selectedColor; */
        //alert(selectedColor);
        setColor(selectedColor);
}   
function setDesc(){
    var arrow = arrec[selectedRow];
    if(activeView=="ROOM"){
    arrow[TEXTE_HEADER] = document.getElementById("textePalette").value;
    }
    if(activeView=="CARTON"){
        arrow[ARG1_HEADER] = document.getElementById("prefix").value;
        arrow[ARG2_HEADER] = document.getElementById("article").value;
        arrow[QUANTITE_HEADER] = document.getElementById("nbrCoiffes").value;
    }
    changeArrayRow(selectedRow,arrow);
}
function toggle2(showHideDiv, switchTextDiv) {
	var ele = document.getElementById(showHideDiv);
	var text = document.getElementById(switchTextDiv);
	if(ele.style.display == "block") {
    		ele.style.display = "none";
		text.innerHTML = "restore";
  	}
	else {
		ele.style.display = "block";
		text.innerHTML = "collapse";
	}
}

function toggleVueCartonMenu(){
    document.getElementById("descrip_palette").style.display="none";
    document.getElementById("descrip_carton").style.display="block";
}
function toggleVuePaletteMenu(){
    document.getElementById("descrip_palette").style.display="block";
    document.getElementById("descrip_carton").style.display="none";
}
        </script>
        
    </head>
    <body>
       <div id="page_container">
            <div id="header">
                <h1>Stock Manager</h1>
            </div>
            <div id="headerDiv">
            <div id="titleText">Hide/Show Div Demo - Click here ==></div><a id="myHeader" href="javascript:toggle2('centermenu','myHeader');" >collapse</a>
            </div>
           <INPUT TYPE=button id ="vuePalette" style="width:100px;height:50px" VALUE="vue palette" onClick="vuePaletteBtnPressed()">
            <INPUT TYPE=button id ="vueCarton" style="width:100px;height:50px" VALUE="vue carton" onClick="vueCartonBtnPressed()" disabled>
            <div style="clear:both;"></div>
            <div id="contentDiv">
                <div id="descrip_palette" style="display: block;">
                    <INPUT TYPE=text id ="textePalette" style="width:200px;height:50px" VALUE="desc palette" >
                    <INPUT TYPE=text id ="nbrCarton" style="width:60px;height:50px" VALUE="12" >
                    <INPUT TYPE=button id ="descBtn" style="width:60px;height:50px" VALUE="OK" onClick="setDesc()">
                    <input type="button" id="cinput2" class="color" value="#00aa00" style="width:100px;height:60px;display:all" onClick="setHexColor(value)" />
                    <INPUT TYPE=button id ="addBtn" style="width:200px;height:50px" VALUE="ajouter palette" onClick="addProductBtn()">
                    <INPUT TYPE=button id ="rotate" style="width:60px;height:50px" VALUE="rotation" onClick="rotate()">
                </div>
                <div id="descrip_carton" style="display: none;">
                    <INPUT TYPE=text id ="prefix" style="width:60px;height:50px" VALUE="C10" >
                    <INPUT TYPE=text id ="article" style="width:60px;height:50px" VALUE="02000127" >
                    <INPUT TYPE=text id ="nbrCoiffes" style="width:60px;height:50px" VALUE="2500" >
                    <INPUT TYPE=button id ="descBtn" style="width:60px;height:50px" VALUE="OK" onClick="setDesc()">
                    <input type="button" id="cinput2" class="color" value="#00aa00" style="width:100px;height:60px;display:all" onClick="setHexColor(value)" />
                    <INPUT TYPE=button id ="addBtn" style="width:200px;height:50px" VALUE="ajouter palette" onClick="addProductBtn()">
                        <INPUT TYPE=button id ="rotate" style="width:60px;height:50px" VALUE="rotation" onClick="rotate()">
                </div>
                
                
                
            
            <div id="centermenu" style="display: block;">
                <INPUT TYPE=button id ="getClient" style="width:100px;height:50px" VALUE="requête" onClick="ajaxFunction()">
                <INPUT TYPE=button id ="removeAll" style="width:100px;height:50px" VALUE="clean" onClick="removeLclDb()">
                <INPUT TYPE=button id ="update" style="width:100px;height:50px" VALUE="update" onClick="updateBtn()">
                <INPUT TYPE=button id ="syncM2S" style="width:100px;height:50px" VALUE="sync M2S" onClick="syncM2SBtn()">
                <INPUT TYPE=button id ="syncS2M" style="width:100px;height:50px" VALUE="sync S2M" onClick="syncS2MBtn()">
                <INPUT TYPE=button id ="zoomplus" style="width:60px;height:50px" VALUE="zoom +" onClick="zoomplus()">
                <INPUT TYPE=button id ="zoommoins" style="width:60px;height:50px" VALUE="zoom -" onClick="zoommoins()">
                <INPUT TYPE=text id ="wheelvalue" style="width:60px;height:50px" VALUE="0" >
                <INPUT TYPE=text id ="xoff" style="width:60px;height:50px" VALUE="-80" >
                <INPUT TYPE=text id ="yoff" style="width:60px;height:50px" VALUE="-320" >
                <INPUT TYPE=text id ="verb1" style="width:150px;height:50px" VALUE="0" >
                <INPUT TYPE=text id ="verb2" style="width:150px;height:50px" VALUE="0" >
                <INPUT TYPE=text id ="verb3" style="width:150px;height:50px" VALUE="0" >
                <INPUT TYPE=text id ="verb4" style="width:150px;height:50px" VALUE="0" >
                <INPUT TYPE=text id ="verb5" style="width:150px;height:50px" VALUE="0" >
             </div>
                 <div id="prebar" style="display: block;">
                 </div>
                <div id="bar" style="display: block;">
                <input TYPE=text name="lines" style="alignment-adjust: middle" min="0" max="10" step="0.5" value="0">
                </div>
                <div id="afterbar" style="display: block;">
                 </div>
            </div>
            <div id="svgrow">
                <div id="svgbasics" class="no-copy"></div>
                <div id="svgmenu" >
                        <svg id="mainMenu"  viewBox="0 0 1024 768" width="100%" height="100%"  xmlns:xlink="http://www.w3.org/1999/xlink" onload="initialize()" zoomAndPan="disable" xml:space="preserve">	
                            <g id="mainBackground"/>
                            <defs>
                            <!-- Symbol for Slider -->
                            <symbol id="sliderSymbol" overflow="visible">
                                <line x1="0" y1="-40" x2="0" y2="40" stroke="green" stroke-width="50" pointer-events="none"/>
                            </symbol>
                            <symbol id="sliderSymbolCp" overflow="visible">
                                <line x1="0" y1="-40" x2="0" y2="40" stroke="gray" stroke-width="20" pointer-events="none"/>
                            </symbol>
                            
                        </defs>
                            <defs>
                                <symbol id="vertsliderSymbol" overflow="visible">
                                <line x1="0" y1="-30" x2="0" y2="30" stroke="red" stroke-width="25" pointer-events="none"/>
                            </symbol>
                            </defs>
                            <defs>
                                <symbol id="horisliderSymbol" overflow="visible">
                                <line x1="0" y1="-30" x2="0" y2="30" stroke="red" stroke-width="25" pointer-events="none"/>
                            </symbol>
                            </defs>
                            <text id="resultText" x="100" y="530" xml:space="preserve">ResultText</text>	
                            <g id="combo1"/>
                            <g id="textbox2"/>
                            <g id="textbox3"/>
                            <g id="zoomslider" />
                            <g id="vertslider" />
                            <g id="horislider" />
                            <g id="textbuttons"/>
                            <g id="colourPickers" />
                            
                        </svg>
                </div>
            </div>
            <div id ="right_column">
                
            </div>
            
            <div id="footer"></div>
            
            <div id="log" style="display:none;">
                <input type="text" name="txtarea" />
                <a id="colorpicker" href="http://www.menucool.com/color-picker">Color Picker for website, easy-to-use</a> 
            </div>
            
            <div id="msg"></div>
            
        </div>
        
    </body>
</html>
